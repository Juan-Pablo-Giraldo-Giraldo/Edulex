<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Simulador - Inicio</title>
    <link rel="stylesheet" href="palette.css" />
    <link rel="stylesheet" href="principal-estil.css" />
</head>
<body>
    <div class="wrap">
      <header class="sim-header" role="banner">
        <h1 class="sim-title">SECCIÓN DE LA SIMULACIÓN</h1>
        <div class="law-pill">Ley 1620 de 2013</div>
        <div class="bug-area">
          <div class="logo" aria-label="report bug" title="Reportar bug" role="button" tabindex="0">
            <svg id="bugIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="44" height="44" fill="currentColor" style="color:var(--deep-blue);cursor:pointer" aria-hidden="false" focusable="true" title="Reportar bug">
              <path d="M20 8h-2.26A6.97 6.97 0 0 0 14 6.1V5h1a1 1 0 1 0 0-2h-6a1 1 0 1 0 0 2h1v1.1A6.97 6.97 0 0 0 6.26 8H4a1 1 0 0 0 0 2h1.05A7.01 7.01 0 0 0 11 17v1H9a1 1 0 1 0 0 2h6a1 1 0 1 0 0-2h-2v-1a7.01 7.01 0 0 0 5.95-7H20a1 1 0 0 0 0-2zM12 15a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
            </svg>
          </div>
        </div>
      </header>

      <main class="sim-main" id="top">
        <section class="tiles">
          <div class="tile-row">
            <div class="tile">Aplicación de las leyes a situaciones reales</div>
            <div class="tile">Repaso de las leyes</div>
          </div>
          <div class="tile-center">Aplicación de las leyes a situaciones reales</div>
        </section>

        <section class="actions">
          <button class="big-btn">Informe final</button>
          <button class="big-btn">Puntuación total</button>
        </section>
      </main>
    </div>
    
    <!-- Script de previsualización eliminado: las iframes ahora se cargan automáticamente en el HTML. -->

    <!-- Bug report modal -->
    <div id="bugModal" class="modal" aria-hidden="true">
      <div class="modal-backdrop" id="bugBackdrop"></div>
      <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="bugModalTitle">
        <h3 id="bugModalTitle">Reportar un bug</h3>
        <form id="bugForm">
          <label for="bugTitle">Asunto</label>
          <input id="bugTitle" name="title" type="text" placeholder="Breve descripción" required />

          <label for="bugDesc">Descripción</label>
          <textarea id="bugDesc" name="description" rows="6" placeholder="Describe qué ocurre y pasos para reproducir" required></textarea>

          <label for="bugFile">Adjuntar captura (opcional)</label>
          <input id="bugFile" name="screenshot" type="file" accept="image/*" />

          <div style="display:flex;gap:8px;margin-top:12px;align-items:center">
            <button type="submit" class="btn">Enviar reporte</button>
            <button type="button" id="bugCancel" class="btn">Cancelar</button>
            <div id="bugStatus" style="margin-left:8px;color:var(--deep-blue)"></div>
          </div>
        </form>
      </div>
    </div>

    <style>
    .modal{display:none;position:fixed;inset:0;z-index:1200}
    .modal[aria-hidden="false"]{display:block}
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.4)}
    .modal-content{position:relative;max-width:720px;margin:6vh auto;background:#fff;padding:18px;border-radius:10px;box-shadow:0 12px 40px rgba(0,0,0,0.2)}
    .modal-content input[type="text"],.modal-content textarea{width:100%;padding:8px;border:1px solid #ddd;border-radius:6px}
    .modal-content label{display:block;margin-top:8px;font-weight:600}
    </style>

    <script>
    (function(){
      const bugIcon = document.getElementById('bugIcon');
      const bugModal = document.getElementById('bugModal');
      const bugBackdrop = document.getElementById('bugBackdrop');
      const bugCancel = document.getElementById('bugCancel');
      const bugForm = document.getElementById('bugForm');
      const bugStatus = document.getElementById('bugStatus');

      function openBugModal(){ bugModal.setAttribute('aria-hidden','false'); document.getElementById('bugTitle').focus(); }
      function closeBugModal(){ bugModal.setAttribute('aria-hidden','true'); bugStatus.textContent=''; bugForm.reset(); }

      if(bugIcon){ bugIcon.addEventListener('click', openBugModal); bugIcon.parentElement.addEventListener('keypress', function(e){ if(e.key==='Enter' || e.key===' ') openBugModal(); }); }
      if(bugBackdrop) bugBackdrop.addEventListener('click', closeBugModal);
      if(bugCancel) bugCancel.addEventListener('click', closeBugModal);

      async function toBase64(file){ return new Promise((res,rej)=>{ const r=new FileReader(); r.onload=()=>res(r.result.split(',')[1]); r.onerror=rej; r.readAsDataURL(file); }); }

      bugForm.addEventListener('submit', async function(e){
        e.preventDefault();
        bugStatus.textContent='Enviando...';
        const title = document.getElementById('bugTitle').value.trim();
        const description = document.getElementById('bugDesc').value.trim();
        const fileInput = document.getElementById('bugFile');
        let screenshot = null;
        if(fileInput.files && fileInput.files[0]){
          try{ screenshot = await toBase64(fileInput.files[0]); }catch(err){ console.warn('error encoding file',err); }
        }

        const payload = { title, description, screenshot, ts: new Date().toISOString(), page: window.location.pathname };

        // Intentar enviar al servidor; si falla, guardar en localStorage
        try{
          const res = await fetch('/report-bug', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
          if(res.ok){ bugStatus.textContent='Reporte enviado. Gracias.'; setTimeout(closeBugModal,1200); return; }
        }catch(err){ /* ignore */ }

        // fallback: save to localStorage
        try{
          const key = 'bugReports';
          const prev = JSON.parse(localStorage.getItem(key) || '[]');
          prev.push(payload);
          localStorage.setItem(key, JSON.stringify(prev));
          bugStatus.textContent='Guardado localmente (sin servidor).';
          setTimeout(closeBugModal,1200);
        }catch(err){ bugStatus.textContent='Error al guardar reporte.' }
      });
    })();
    </script>

    <style>
    /* Requested palette and centering: Azul Profundo, Verde Claro, Amarillo, Gris Pizarra, Blanco Suave, Rojo Suave */
    :root{
      --deep-blue: #254A74; /* Fondo, navegación */
      --light-green: #7DC785; /* Éxitos, rutas personalizadas */
      --gold: #FFD44D; /* Recompensas, hitos */
      --slate: #5C6275; /* Fondos secundarios, formularios */
      --soft-white: #F6F9FB; /* Área de texto, tarjetas */
      --soft-red: #F09A92; /* Error, advertencia */
    }
    html,body{height:100%;margin:0}
    .wrap{display:flex;align-items:center;justify-content:center;min-height:100vh;flex-direction:column;background:var(--soft-white);padding:20px}
    .sim-header{position:relative;text-align:center}
    .sim-title{font-size:34px;letter-spacing:2px;margin:6px 0;color:var(--deep-blue)}
    .law-pill{display:inline-block;background:var(--light-green);color:var(--deep-blue);padding:8px 18px;border-radius:12px;margin-top:6px;font-weight:700}
    .bug-area{position:fixed;right:18px;top:18px;z-index:1300}

    .sim-main{padding:18px;display:flex;flex-direction:column;align-items:center;justify-content:center}
    .tiles{max-width:1100px;margin:12px auto;text-align:center}
    .tile-row{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-bottom:18px}
    .tile, .tile-center{background:rgba(37,74,116,0.12);padding:26px;border-radius:4px;color:var(--deep-blue);font-size:20px;display:flex;align-items:center;justify-content:center}
    .tile-center{width:60%;margin:0 auto;display:block}

    .actions{display:flex;gap:18px;justify-content:center;margin:28px 0}
    .big-btn{background:var(--deep-blue);color:var(--soft-white);border-radius:18px;padding:18px 48px;font-size:34px;border:none;cursor:pointer}
    /* Bug icon styling: make it stand out with gold background */
    .logo svg{background:var(--gold);border-radius:8px;padding:6px;color:var(--deep-blue)}
    </style>
</body>
</html>